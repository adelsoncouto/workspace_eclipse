<?php

require_once "model/Animal.php";
require_once "model/Categoria.php";

class MainController
{
	public function __construct()
	{
		if(empty($_SESSION['categoria']))
		{
			//ambiente
			$agua  = new Categoria('Água');
			$terra = new Categoria('Terra');
			
			//primeros animais
			$tubarao = new Animal(0, 'tubarao', null);
			$macaco = new Animal(0, 'macaco', null);
			
			$terra->addFilho($macaco);
			$agua->addFilho($tubarao);
			
			//agrupador
			$categorias = new Categoria('Jogo');
			$categorias->addFilho($agua);
			$categorias->addFilho($terra);
			
			//armazenamento
			$_SESSION['categoria'] = serialize($categorias);
			
			//historico
			$_SESSION['historico'] = array(0);
		}
		
	}

	public function init()
	{
		require_once "view/inicio.php";
	}
	
	public function start()
	{

		$pai = unserialize($_SESSION['categoria']);
		$eu = null;
		foreach($_SESSION['historico'] as $index=>$filho){
			if($index > 0){
				$pai = $eu;
			}
			$eu = $pai->getFilhos()[$filho];
		}
		
		$_REQUEST['msg'] = $eu->getPergunta();
		
		require_once "view/pergunta.php";
	}
	
	public function pergunta()
	{
		
		$resposta = $_GET['resp'];
		$msg = '';
		switch($resposta){
			case 'sim':{
				$pai = unserialize($_SESSION['categoria']);
				$eu = null;
				foreach($_SESSION['historico'] as $index=>$filho){
					if($index > 0){
						$pai = $eu;
					}
					$eu = $pai->getFilhos()[$filho];
				}
				
				if(empty($eu->getFilhos())){
					$msg = 'O animal que você pensou é '.$eu->getNome();
				}else{
					$msg = $eu->getFilhos()[0]->getPergunta();
				}
				
				break;
			}
			case 'nao':{
				break;
			}
			case 'ok':{
				break;
			}
			case 'input':{
				break;
			}
			case 'categoria':{
				break;
			}
		}
		
		
		$_REQUEST['msg'] = $msg;
		require_once "view/pergunta.php";
	}
	
}