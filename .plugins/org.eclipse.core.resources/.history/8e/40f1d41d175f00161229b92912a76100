<?php
namespace Model\Model;
use \Model\Model\Model;
use \Model\Banco\SistemaConexao;
use \Model\Banco\Util;
		
class Feriado extends Model{
	
	private $id;
	private $data;
	private $horaInicio;
	private $horaFim;
	private $tipo;
	private $municipioId;
	private $descricao;
	private $ufId;
	
	/**
	* Construtor
	* @param int $aId opcional, se informado busca o objeto no banco de dados
	*/
	public function __construct($aId = null){
		if($aId != null){
			SistemaConexao::objeto($aId, $this);
		}
	}
		
	public function __destruct(){
	}
	
	///////GET
	
	public function getId(){
		return $this->id;
	}
	public function getData($isObject = false){
		return new \DateTime($this->data);
	}
	public function getHoraInicio($isObject = false){
		return new \DateTime($this->horaInicio);
	}
	public function getHoraFim($isObject = false){
		return new \DateTime($this->horaFim);
	}
	public function getTipo(){
		return $this->tipo;
	}
	public function getMunicipioId(){
		return $this->municipioId;
	}
	public function getDescricao(){
		return $this->descricao;
	}
	public function getUfId(){
		return $this->ufId;
	}
	
	///////SET
	
	public function setId($aId){
		$this->id = $aId;
	}
	public function setData($aData){
		$this->data = $aData;
	}
	public function setHoraInicio($aHoraInicio){
		$this->horaInicio = $aHoraInicio;
	}
	public function setHoraFim($aHoraFim){
		$this->horaFim = $aHoraFim;
	}
	public function setTipo($aTipo){
		$this->tipo = $aTipo;
	}
	public function setMunicipioId($aMunicipioId){
		$this->municipioId = $aMunicipioId;
	}
	public function setDescricao($aDescricao){
		$this->descricao = $aDescricao;
	}
	public function setUfId($aUfId){
		$this->ufId = $aUfId;
	}
	/**
	* Método responsável por retornar uma versão da classe em array
	*/
	public function toArray(){
		$attr = get_object_vars($this);
		foreach($attr as $k=>$v){
			if(preg_match("/^_/",$k)){
				unset($attr[$k]);
			}
		}
		return $attr;
	}
					
	/**
	* Método responsável por retornar o de/para das colunas do objeto com o banco
	* @param string $aAliasTabela aliás da tabela
	* @return string 
	*/
	public function dePara($aAliasTabela = ""){
		$alias = "";
		if(!empty($aAliasTabela)){
			$alias = $aAliasTabela.".";
		}
		$colunas = [];
		$attr = get_object_vars($this);
		foreach($attr as $k=>$v){
			if(preg_match("/^_/",$k)){
				unset($attr[$k]);
			}else{
				$colunas[] = $alias.Util::maiusculaToUnderline($k)." as ".$k;
			}
		}
		return implode(",",$colunas);
	}
					
	/**
	* Método responsável por retornar o nome simples da classe
	*/
	public function className(){
		return "Feriado";
	}

	/**
	* Método responsável por retornar o nome completo da classe
	*/
	public function absoluteClassName(){
		return "\Model\Model\Feriado";
	}
					
	
	
	/**
	* Método responsável por retornar a lista de Feriado com base no id de municipio
	* Em caso de herança deve ser reimplementado
	* @param int $aMunicipioId id de municipio
	* @return \Model\Model\Feriado[]
	*/
	public function buscarPorMunicipio($aMunicipioId){
		$sql = "SELECT 
					id as id, 
					data as data, 
					hora_inicio as horaInicio, 
					hora_fim as horaFim, 
					tipo as tipo, 
					municipio_id as municipioId, 
					descricao as descricao, 
					uf_id as ufId 
				FROM 
					feriado
				WHERE
					municipio_id =:id";
		$pst = SistemaConexao::getInstance()->prepare($sql);
		$pst->execute([":id"=>$aMunicipioId]);
		$result = [];
		while($obj = $pst->fetchObject("\Model\Model\Feriado")){
			$result[] = $obj;
		}
		return $result;
	}
	
	/**
	* Método responsável por retornar a lista de Feriado com base no id de uf
	* Em caso de herança deve ser reimplementado
	* @param int $aUfId id de uf
	* @return \Model\Model\Feriado[]
	*/
	public function buscarPorUf($aUfId){
		$sql = "SELECT 
					id as id, 
					data as data, 
					hora_inicio as horaInicio, 
					hora_fim as horaFim, 
					tipo as tipo, 
					municipio_id as municipioId, 
					descricao as descricao, 
					uf_id as ufId 
				FROM 
					feriado
				WHERE
					uf_id =:id";
		$pst = SistemaConexao::getInstance()->prepare($sql);
		$pst->execute([":id"=>$aUfId]);
		$result = [];
		while($obj = $pst->fetchObject("\Model\Model\Feriado")){
			$result[] = $obj;
		}
		return $result;
	}
}